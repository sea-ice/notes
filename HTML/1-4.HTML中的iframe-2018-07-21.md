## iframe

### 不安全的iframe

默认情况下，iframe可以读写包含自身的同域父窗口（即页面的document.domain值相同即可，端口可以不同）的location，也可以执行嵌入的页面所包含的JavaScript脚本。

跨域的一种方式就是通过设置嵌入的子页面和父页面相同的document.domain值来实现通信的。

### HTML5增强的iframe

为了限制iframe访问资源的能力，避免一些恶意的攻击，HTML5中对iframe做出了限制，开发者可以在iframe元素上通过设置sandbox属性来限制iframe。如果指定了sandbox属性，但是不设置具体值，则会采用默认的安全策略，即iframe的页面被当作一个独立的源，不能提交表单，不能执行JavaScript脚本，同时也不能将父窗口导航到其他页面，当前iframe框架中可以跳转到其他页面，但是加载的所有的页面都无法执行JavaScript脚本。举例：

```html
<!-- index.html，从localhost:8888访问 -->
<iframe src="http://localhost:8890/inside.html" frameborder="0" sandbox></iframe>

<!-- target.html，从localhost:8888访问 -->
<h1>seaice's demo</h1>
<script>console.log('from target')</script>

<!-- inside.html，从localhost:8890访问 -->
<a href="http://localhost:8888/target.html" target="_parent">parent</a>
<a href="http://localhost:8888/target.html" target="_top">top</a>
<a href="http://localhost:8888/target.html" target="_self">self</a>
<form action="./post">
  <input type="submit" value="submit">
</form>
```

实验会发现iframe元素中加载的页面parent和top链接无法修改父窗口的URL，self链接在当前iframe元素中加载的target页面脚本无法执行，同时表单也无法提交。

如果需要放宽限制，可以根据需要设置sandbox属性的值。比如：

allow-scripts：允许iframe元素加载的页面执行JavaScript脚本，此时加载的页面document.domain值始终为空，意味着该页面是不能和父窗口加载的页面通信的。
allow-same-origin：在allow-scripts基础上再增加此属性值，会设置iframe加载的页面document.domain值，如果两个页面的源（包括域和端口都一样）完全一样，两个页面才能彼此通信，这和不设置sandbox属性只需要iframe加载的页面和父窗口的页面两者的document.domain值相同就能通信有所不同。
allow-forms：允许表单提交
allow-top-navigation：允许iframe中加载的页面中的target属性值为_parent、_top的链接跳转



